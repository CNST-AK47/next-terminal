"use strict";(self.webpackChunknext_terminal=self.webpackChunknext_terminal||[]).push([[6072],{26072:function(e,n,t){t.r(n),t.d(n,{default:function(){return F}});var r=t(74165),a=t(15861),o=t(44925),i=t(29439),c=t(47313),l=t(15508),s=t(74294),d=t(57325),u=t(66204),f=t(59491),p=t(55291),m=t(5900),h=t(23813),x=t(96296),Z=t(53469),v=t(88928),y=t(96216),k=t(37389),I=t(9388),w=t(95519),g=t(87591),j=t(40056),T=t(27777),b=t(66530),C=t(46417),S=["type","defaultRender"],O=["type","defaultRender"],N=["type","defaultRender"],R=l.Z.Content,L=c.createRef(),E=w.Z,F=function(){var e,n,t=(0,v.T)(v.Z.OFFLINE_SESSION),l=(0,i.Z)(t,2),w=l[0],F=l[1],z=(0,c.useState)([]),D=(0,i.Z)(z,2),P=D[0],_=D[1],B=(0,j.useQuery)("userQuery",T.Z.getAll),Q=(0,j.useQuery)("assetQuery",b.Z.getAll),A=null===(e=B.data)||void 0===e?void 0:e.map((function(e){return{label:e.nickname,value:e.id}})),K=null===(n=Q.data)||void 0===n?void 0:n.map((function(e){return{label:e.name,value:e.id}})),q=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"\u6765\u6e90IP",dataIndex:"clientIp",key:"clientIp"},{title:"\u7528\u6237\u6635\u79f0",dataIndex:"creatorName",key:"creatorName",renderFormItem:function(e,n,t){var r=n.type;n.defaultRender,(0,o.Z)(n,S);return"form"===r?null:(0,C.jsx)(s.Z,{showSearch:!0,filterOption:function(e,n){var t;return(null!==(t=null===n||void 0===n?void 0:n.label)&&void 0!==t?t:"").toLowerCase().includes(e.toLowerCase())},allowClear:!0,options:A})}},{title:"\u8d44\u4ea7\u540d\u79f0",dataIndex:"assetName",key:"assetName",renderFormItem:function(e,n,t){var r=n.type;n.defaultRender,(0,o.Z)(n,O);return"form"===r?null:(0,C.jsx)(s.Z,{showSearch:!0,filterOption:function(e,n){var t;return(null!==(t=null===n||void 0===n?void 0:n.label)&&void 0!==t?t:"").toLowerCase().includes(e.toLowerCase())},allowClear:!0,options:K})}},{title:"\u8fde\u63a5\u534f\u8bae",dataIndex:"protocol",key:"protocol",render:function(e,n){var t="".concat(n.username,"@").concat(n.ip,":").concat(n.port);return(0,C.jsx)(d.Z,{title:t,children:(0,C.jsx)(u.Z,{color:I.f[e],children:e})})},renderFormItem:function(e,n,t){var r=n.type;n.defaultRender,(0,o.Z)(n,N);return"form"===r?null:(0,C.jsxs)(s.Z,{children:[(0,C.jsx)(s.Z.Option,{value:"rdp",children:"RDP"}),(0,C.jsx)(s.Z.Option,{value:"ssh",children:"SSH"}),(0,C.jsx)(s.Z.Option,{value:"telnet",children:"Telnet"}),(0,C.jsx)(s.Z.Option,{value:"kubernetes",children:"Kubernetes"})]})}},{title:"\u63a5\u5165\u65f6\u95f4",dataIndex:"connectedTime",key:"connectedTime",hideInSearch:!0},{title:"\u63a5\u5165\u65f6\u957f",dataIndex:"connectedTimeDur",key:"connectedTimeDur",render:function(e,n){return n.connectedTime?(0,y.I6)(new Date(n.connectedTime),new Date(n.disconnectedTime)):"-"},hideInSearch:!0},{title:"\u64cd\u4f5c",valueType:"option",key:"option",render:function(e,n,t,o){var i="1"!==n.recording;n.commandCount;return[(0,C.jsx)(g.Z,{menu:"offline-session-playback",children:(0,C.jsx)(f.Z,{disabled:i,type:"link",size:"small",onClick:function(){switch(n.mode){case"naive":case"native":case"terminal":(0,k.L)("#/term-playback?sessionId=".concat(n.id),n.id,1024,520);break;case"guacd":(0,k.L)("#/guacd-playback?sessionId=".concat(n.id),n.id,1024,768);break;default:p.ZP.info("\u6570\u636e\u5f02\u5e38")}},children:"\u56de\u653e"},"monitor")},"offline-session-playback"),(0,C.jsx)(g.Z,{menu:"offline-session-del",children:(0,C.jsx)(m.Z,{title:"\u60a8\u786e\u5b9a\u8981\u5220\u9664\u6b64\u4f1a\u8bdd\u5417?",onConfirm:(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.deleteById(n.id);case 2:L.current.reload();case 3:case"end":return e.stop()}}),e)}))),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",children:(0,C.jsx)("a",{className:"danger",children:"\u5220\u9664"},"delete")},"confirm-delete")},"offline-session-del")]}}];return(0,C.jsx)(R,{className:"page-container",children:(0,C.jsx)(Z.Z,{columns:q,actionRef:L,columnsState:{value:w,onChange:F},request:(0,a.Z)((0,r.Z)().mark((function e(){var n,t,a,o,i,c,l=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>0&&void 0!==l[0]?l[0]:{},t=l.length>1?l[1]:void 0,l.length>2?l[2]:void 0,a="",o="",Object.keys(t).length>0&&(a=Object.keys(t)[0],o=Object.values(t)[0]),i={pageIndex:n.current,pageSize:n.pageSize,protocol:n.protocol,clientIp:n.clientIp,userId:n.creatorName,assetId:n.assetName,field:a,order:o,status:"disconnected"},e.next=9,E.getPaging(i);case 9:return c=e.sent,e.abrupt("return",{data:c.items,success:!0,total:c.total});case 11:case"end":return e.stop()}}),e)}))),rowKey:"id",rowClassName:function(e,n){return e.reviewed?"":"unreviewed"},rowSelection:{selections:[h.Z.SELECTION_ALL,h.Z.SELECTION_INVERT],selectedRowKeys:P,onChange:function(e){_(e)}},search:{labelWidth:"auto"},pagination:{defaultPageSize:10,showSizeChanger:!0},dateFormatter:"string",headerTitle:"\u79bb\u7ebf\u4f1a\u8bdd\u5217\u8868",toolBarRender:function(){return[(0,C.jsx)(g.Z,{menu:"offline-session-del",children:(0,C.jsx)(f.Z,{danger:!0,type:"primary",disabled:0===P.length,onClick:function(){x.Z.confirm({title:"\u60a8\u786e\u5b9a\u8981\u5220\u9664\u9009\u4e2d\u7684\u884c\u5417?",content:"\u5220\u9664\u4e4b\u540e\u65e0\u6cd5\u8fdb\u884c\u6062\u590d\uff0c\u8bf7\u614e\u91cd\u8003\u8651\u3002",okText:"\u786e\u5b9a",okType:"danger",cancelText:"\u53d6\u6d88",onOk:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.deleteById(P.join(","));case 2:L.current.reload(),_([]);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()})},children:"\u5220\u9664"},"delete")}),(0,C.jsx)(g.Z,{menu:"offline-session-clear",children:(0,C.jsx)(f.Z,{danger:!0,type:"primary",onClick:function(){x.Z.confirm({title:"\u60a8\u786e\u5b9a\u8981\u6e05\u7a7a\u5168\u90e8\u4f1a\u8bdd\u5417?",content:"\u6e05\u7a7a\u4e4b\u540e\u65e0\u6cd5\u8fdb\u884c\u6062\u590d\uff0c\u8bf7\u614e\u91cd\u8003\u8651\u3002",okText:"\u786e\u5b9a",okType:"danger",cancelText:"\u53d6\u6d88",onOk:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.clear();case 2:L.current.reload(),_([]);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()})},children:"\u6e05\u7a7a"},"clear")})]}})})}}}]);