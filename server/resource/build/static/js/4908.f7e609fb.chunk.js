"use strict";(self.webpackChunknext_terminal=self.webpackChunknext_terminal||[]).push([[4908],{58374:function(n,t,e){e.d(t,{Z:function(){return f}});var r=e(74165),c=e(15861),a=e(43144),o=e(15671),u=e(96675),s=e(74776),i=e.n(s),f=(0,a.Z)((function n(t){var e=this;(0,o.Z)(this,n),this.group="",this.getById=function(){var n=(0,c.Z)((0,r.Z)().mark((function n(t){var c;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.Z.get("/".concat(e.group,"/").concat(t));case 2:if(1===(c=n.sent).code){n.next=5;break}return n.abrupt("return");case 5:return n.abrupt("return",c.data);case 6:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),this.getPaging=function(){var n=(0,c.Z)((0,r.Z)().mark((function n(t){var c,a;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return c=i().stringify(t),n.next=3,u.Z.get("/".concat(e.group,"/paging?").concat(c));case 3:if(1===(a=n.sent).code){n.next=6;break}return n.abrupt("return",{});case 6:return n.abrupt("return",a.data);case 7:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),this.getAll=(0,c.Z)((0,r.Z)().mark((function n(){var t;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.Z.get("/".concat(e.group));case 2:if(1===(t=n.sent).code){n.next=5;break}return n.abrupt("return",[]);case 5:return n.abrupt("return",t.data);case 6:case"end":return n.stop()}}),n)}))),this.create=function(){var n=(0,c.Z)((0,r.Z)().mark((function n(t){var c;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.Z.post("/".concat(e.group),t);case 2:return c=n.sent,n.abrupt("return",1===c.code);case 4:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),this.updateById=function(){var n=(0,c.Z)((0,r.Z)().mark((function n(t,c){var a;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.Z.put("/".concat(e.group,"/").concat(t),c);case 2:return a=n.sent,n.abrupt("return",1===a.code);case 4:case"end":return n.stop()}}),n)})));return function(t,e){return n.apply(this,arguments)}}(),this.deleteById=function(){var n=(0,c.Z)((0,r.Z)().mark((function n(t){var c;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.Z.delete("/".concat(e.group,"/").concat(t));case 2:return c=n.sent,n.abrupt("return",1===c.code);case 4:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),this.group=t}))},23593:function(n,t,e){var r=e(74165),c=e(15861),a=e(43144),o=e(15671),u=e(60136),s=e(27277),i=e(58374),f=e(96675),p=function(n){(0,u.Z)(e,n);var t=(0,s.Z)(e);function e(){var n;return(0,o.Z)(this,e),(n=t.call(this,"commands")).changeOwner=function(){var t=(0,c.Z)((0,r.Z)().mark((function t(e,c){var a;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.Z.post("/".concat(n.group,"/").concat(e,"/change-owner?owner=").concat(c));case 2:return a=t.sent,t.abrupt("return",1===a.code);case 4:case"end":return t.stop()}}),t)})));return function(n,e){return t.apply(this,arguments)}}(),n}return(0,a.Z)(e)}(i.Z),d=new p;t.Z=d},95519:function(n,t,e){var r=e(74165),c=e(15861),a=e(43144),o=e(15671),u=e(60136),s=e(27277),i=e(58374),f=e(74776),p=e.n(f),d=e(96675),Z=function(n){(0,u.Z)(e,n);var t=(0,s.Z)(e);function e(){var n;return(0,o.Z)(this,e),(n=t.call(this,"sessions")).GetCommandPagingBySessionId=function(){var t=(0,c.Z)((0,r.Z)().mark((function t(e,c){var a,o;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=p().stringify(c),t.next=3,d.Z.get("/".concat(n.group,"/").concat(e,"/commands/paging?").concat(a));case 3:if(1===(o=t.sent).code){t.next=6;break}return t.abrupt("return",{});case 6:return t.abrupt("return",o.data);case 7:case"end":return t.stop()}}),t)})));return function(n,e){return t.apply(this,arguments)}}(),n.create=function(){var t=(0,c.Z)((0,r.Z)().mark((function t(e,c){var a;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.Z.post("/".concat(n.group,"?assetId=").concat(e,"&mode=").concat(c));case 2:if(1===(a=t.sent).code){t.next=5;break}return t.abrupt("return",{});case 5:return t.abrupt("return",a.data);case 6:case"end":return t.stop()}}),t)})));return function(n,e){return t.apply(this,arguments)}}(),n.connect=function(){var t=(0,c.Z)((0,r.Z)().mark((function t(e){var c;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.Z.post("/".concat(n.group,"/").concat(e,"/connect"));case 2:return c=t.sent,t.abrupt("return",1===c.code);case 4:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),n.disconnect=function(){var t=(0,c.Z)((0,r.Z)().mark((function t(e){var c;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.Z.post("/".concat(n.group,"/").concat(e,"/disconnect"));case 2:return c=t.sent,t.abrupt("return",1===c.code);case 4:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),n.clear=(0,c.Z)((0,r.Z)().mark((function t(){var e;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.Z.post("/".concat(n.group,"/clear"));case 2:return e=t.sent,t.abrupt("return",1===e.code);case 4:case"end":return t.stop()}}),t)}))),n.stats=function(){var t=(0,c.Z)((0,r.Z)().mark((function t(e){var c;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.Z.get("/".concat(n.group,"/").concat(e,"/stats"));case 2:if(1===(c=t.sent).code){t.next=5;break}return t.abrupt("return",{});case 5:return t.abrupt("return",c.data);case 6:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),n.resize=function(){var n=(0,c.Z)((0,r.Z)().mark((function n(t,e,c){var a;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,d.Z.post("/sessions/".concat(t,"/resize?width=").concat(e,"&height=").concat(c));case 2:return a=n.sent,n.abrupt("return",1===a.code);case 4:case"end":return n.stop()}}),n)})));return function(t,e,r){return n.apply(this,arguments)}}(),n}return(0,a.Z)(e)}(i.Z),l=new Z;t.Z=l},48922:function(n,t,e){var r,c=e(15671),a=e(43144),o=(r=function(){function n(t,e){(0,c.Z)(this,n),this.type=t,this.content=e}return(0,a.Z)(n,[{key:"toString",value:function(){return this.type+this.content}}],[{key:"parse",value:function(t){return new n(parseInt(t.substring(0,1)),t.substring(1,t.length))}}]),n}(),r.Closed=0,r.Connected=1,r.Data=2,r.Resize=3,r.Ping=4,r);t.Z=o},12168:function(n,t,e){e.r(t),e.d(t,{default:function(){return I}});var r=e(74165),c=e(15861),a=e(29439),o=e(47313),u=e(2135),s=e(23593),i=e(48922),f=e(66672),p=e(15508),d=e(72652),Z=e(1898),l=(e(66641),e(95519)),h=e(60786),v=e(60270),g=e(96216),w=e(74776),m=e.n(w),x=e(34868),b=e(11829),y=e(40056),k=e(39776),S=e(99925),C=e(46417),E=f.Z.Search,j=p.Z.Content,I=function(){for(var n=(0,o.useState)([]),t=(0,a.Z)(n,2),e=t[0],f=t[1],p=(0,u.lr)(),w=(0,a.Z)(p,2),I=w[0],z=(w[1],I.get("commandId")),B=(0,y.useQuery)("commandQuery",(function(){return s.Z.getById(z)}),{onSuccess:function(n){var t=n.content.split("\n");t&&D.forEach((function(n){!1===G(n.id)&&X(n.id,t)}))},refetchOnWindowFocus:!1}),N=(0,o.useState)(""),A=(0,a.Z)(N,2),P=A[0],T=A[1],D=JSON.parse(I.get("assets")),L=(0,o.useState)(D),O=(0,a.Z)(L,2),W=O[0],F=O[1],J={},Q=0;Q<D.length;Q++)J[D[Q].id]=!1,D[Q].locked=!1;(0,o.useEffect)((function(){return window.addEventListener("resize",R),function(){window.removeEventListener("resize",R),e.forEach((function(n){n.ws&&n.ws.close(),n.term&&n.term.dispose()}))}}),[z]);var R=function(){e.forEach((function(n){n.fitAddon.fit();var t=n.ws;if(t&&t.readyState===WebSocket.OPEN){var e=n.term,r={cols:e.cols,rows:e.rows};t.send(new i.Z(i.Z.Resize,window.btoa(JSON.stringify(r))).toString())}}))},_=function(n){e.push(n),f(e.slice())},G=function(n){return J[n]},X=function(){var n=(0,c.Z)((0,r.Z)().mark((function n(t,e){var c,a,o,u,s,f,p,d;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.Z.create(t,"native");case 2:c=n.sent,a=c.id,o=new h.Terminal({fontFamily:'monaco, Consolas, "Lucida Console", monospace',fontSize:15,theme:{background:"#2d2f2c"},rightClickSelectsWord:!0}),u=new v.FitAddon,o.loadAddon(u),o.open(document.getElementById(t)),u.fit(),o.focus(),o.writeln("Trying to connect to the server ..."),(0,k.E)(),s=(0,g.LP)(),f={cols:o.cols,rows:o.rows,sessionId:a,"X-Auth-Token":s},p=m().stringify(f),d=new WebSocket("".concat(x.tC,"/sessions/").concat(a,"/ssh?").concat(p)),o.onData((function(n){d&&d.send(new i.Z(i.Z.Data,n).toString())})),d.onerror=function(n){o.writeln("Failed to connect to server.")},d.onclose=function(n){o.writeln("Connection is closed.")},d.onmessage=function(n){var t=i.Z.parse(n.data);switch(t.type){case i.Z.Connected:o.clear(),l.Z.connect(a);for(var r=0;r<e.length;r++){var c=e[r];S.Z.hasText(c)&&d.send(new i.Z(i.Z.Data,c+String.fromCharCode(13)).toString())}break;case i.Z.Data:o.write(t.content);break;case i.Z.Closed:o.writeln("\x1b[1;3;31m".concat(t.content,"\x1b[0m ")),d.close()}},_({id:t,ws:d,term:o,fitAddon:u}),r=!0,J[t]=r;case 22:case"end":return n.stop()}var r}),n)})));return function(t,e){return n.apply(this,arguments)}}();return(0,C.jsxs)("div",{children:[(0,C.jsx)(j,{className:"page-container",children:(0,C.jsx)("div",{className:"page-search",children:(0,C.jsx)(E,{placeholder:"\u8bf7\u8f93\u5165\u6307\u4ee4",value:P,onChange:function(n){var t=n.target.value;T(t)},onSearch:function(n){e.forEach((function(t){var e=t.ws;e.readyState===WebSocket.OPEN&&e.send(new i.Z(i.Z.Data,n+String.fromCharCode(13)).toString())})),T("")},enterButton:"\u6267\u884c"})})}),(0,C.jsx)(d.Z,{spinning:B.isLoading,tip:"\u6b63\u5728\u83b7\u53d6\u6307\u4ee4\u5185\u5bb9...",children:(0,C.jsx)("div",{className:"page-card",children:(0,C.jsx)(Z.Z,{ghost:!0,gutter:[8,8],wrap:!0,children:W.map((function(n){return(0,C.jsx)(Z.Z,{className:"term-container",extra:(0,C.jsx)("div",{style:{cursor:"pointer"},onClick:function(){return function(n){var t=e.find((function(t){return t.id===n}));t.ws.close(),t.term.dispose();var r=W.filter((function(t){return t.id!==n}));F(r)}(n.id)},children:(0,C.jsx)(b.Z,{})}),title:n.name,layout:"center",headerBordered:!0,size:"small",colSpan:12,bordered:!0,children:(0,C.jsx)("div",{id:n.id,style:{width:"100%",height:"100%"}})},n.id)}))})})})]})}},99925:function(n,t,e){var r=e(43144),c=e(15671),a=new((0,r.Z)((function n(){(0,c.Z)(this,n),this.hasText=function(n){return!(void 0===n||null===n||0===n.length)},this.zeroPad=function(n,t){for(var e=n.toString();e.length<t;)e="0"+e;return e}})));t.Z=a},39776:function(n,t,e){e.d(t,{E:function(){return r}});var r=function(){for(var n=document.getElementsByClassName("xterm-viewport"),t=function(){var t,r=n[e];r.addEventListener("scroll",(function(n){r.toggleAttribute("scroll",!0),t&&clearTimeout(t),t=setTimeout((function(){r.toggleAttribute("scroll")}),500)}))},e=0;e<n.length;e++)t()}}}]);