"use strict";(self.webpackChunknext_terminal=self.webpackChunknext_terminal||[]).push([[7782],{67782:function(e,t,n){n.d(t,{Z:function(){return Q}});var r=n(93433),s=n(1413),i=n(74165),a=n(15861),o=n(15671),c=n(43144),l=n(60136),d=n(27277),u=n(47313),f=n(81572),p=n(96296),h=n(55291),m=n(61995),g=n(11843),x=n(59491),y=n(5900),Z=n(66672),k=n(45705),j=n(57325),v=n(28080),b=n(23813),w=n(12008),C=n(44391),F=n(99223),D=n(83909),I=n(24924),R=n(12534),T=n(14856),S=n(42667),N=n(855),L=n(91316),P=n(96207),z=n(86801),V=n(34632),E=n(22231),K=n(51515),U=n(47515),O=n(3598),$=n(74776),B=n.n($),H=n(96675),M=n(34868),q=n(96216),A=n(36147),W=n(46417),X=(0,u.lazy)((function(){return n.e(5526).then(n.bind(n,85526))})),_=f.Z.Text,G=p.Z.confirm,J=function(e){(0,l.Z)(n,e);var t=(0,d.Z)(n);function n(){var e;(0,o.Z)(this,n);for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return(e=t.call.apply(t,[this].concat(l))).mkdirFormRef=u.createRef(),e.renameFormRef=u.createRef(),e.state={storageType:void 0,storageId:void 0,currentDirectory:"/",currentDirectoryInput:"/",files:[],loading:!1,currentFileKey:void 0,selectedRowKeys:[],uploading:{},callback:void 0,minHeight:280,upload:!1,download:!1,delete:!1,rename:!1,edit:!1,editorVisible:!1,fileName:"",fileContent:""},e.reSetStorageId=function(t){e.setState({storageId:t},(function(){e.loadFiles("/")}))},e.refresh=(0,a.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.loadFiles(e.state.currentDirectory),e.state.callback&&e.state.callback();case 2:case"end":return t.stop()}}),t)}))),e.loadFiles=function(){var t=(0,a.Z)((0,i.Z)().mark((function t(n){var a,o,c,l,d,u,f;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({loading:!0}),t.prev=1,(0,q.xb)(n)&&(n="/"),(a=new FormData).append("dir",n),t.next=7,H.Z.post("/".concat(e.state.storageType,"/").concat(e.state.storageId,"/ls"),a);case 7:if(1===(o=t.sent).code){t.next=11;break}return h.ZP.error(o.message),t.abrupt("return");case 11:c=o.data,l=c.map((function(e){return(0,s.Z)({key:e.path},e)})),d=function(e,t){var n=e.name.toUpperCase(),r=t.name.toUpperCase();return n<r?-1:n>r?1:0},(u=l.filter((function(e){return!0===e.isDir}))).sort(d),(f=l.filter((function(e){return!1===e.isDir}))).sort(d),u.push.apply(u,(0,r.Z)(f)),"/"!==n&&u.splice(0,0,{key:"..",name:"..",path:"..",isDir:!0,disabled:!0}),e.setState({files:u,currentDirectory:n,currentDirectoryInput:n});case 21:return t.prev=21,e.setState({loading:!1,selectedRowKeys:[]}),t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[1,,21,24]])})));return function(e){return t.apply(this,arguments)}}(),e.handleCurrentDirectoryInputChange=function(t){e.setState({currentDirectoryInput:t.target.value})},e.handleCurrentDirectoryInputPressEnter=function(t){e.loadFiles(t.target.value)},e.handleUploadDir=function(){for(var t=window.document.getElementById("dir-upload").files,n=0,r=0;r<t.length;r++){var s=t[r].webkitRelativePath,i=s.substring(0,s.length-t[r].name.length);e.uploadFile(t[r],e.state.currentDirectory+"/"+i,(function(){++n===t.length&&e.refresh()}))}},e.handleUploadFile=function(){for(var t=window.document.getElementById("file-upload").files,n=0,r=0;r<t.length;r++){var s=t[r];if(!s)return;e.uploadFile(s,e.state.currentDirectory,(function(){++n===t.length&&e.refresh()}))}},e.uploadFile=function(t,n,r){var s=t.name,i=t.size,a="".concat(M.fw,"/").concat(e.state.storageType,"/").concat(e.state.storageId,"/upload?X-Auth-Token=").concat((0,q.LP)(),"&dir=").concat(n),o=s,c=new XMLHttpRequest,l=0,d=0,f=function(e,t){if(e){var n=(0,W.jsxs)(u.Fragment,{children:[(0,W.jsx)("div",{children:s}),(0,W.jsxs)("div",{children:[(0,q.$j)(i)," / ",(0,q.$j)(i)]}),(0,W.jsx)(m.Z,{percent:100})]});g.Z.success({key:o,message:"\u4e0a\u4f20\u6210\u529f",duration:5,description:n,placement:"bottomRight"}),r&&r()}else{var a=(0,W.jsxs)(u.Fragment,{children:[(0,W.jsx)("div",{children:s}),(0,W.jsx)(_,{type:"danger",children:t})]});g.Z.error({key:o,message:"\u4e0a\u4f20\u5931\u8d25",duration:10,description:a,placement:"bottomRight"})}};c.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var t=(0,W.jsxs)(u.Fragment,{children:[(0,W.jsx)("div",{children:s}),(0,W.jsxs)("div",{children:[(0,q.$j)(e.loaded),"/",(0,q.$j)(i)]}),(0,W.jsx)(m.Z,{percent:99})]});if(e.loaded===e.total)return void g.Z.info({key:o,message:"\u5411\u76ee\u6807\u673a\u5668\u4f20\u8f93\u4e2d...",duration:null,description:t,placement:"bottomRight",onClose:function(){c.abort(),h.ZP.info('\u60a8\u5df2\u53d6\u6d88\u4e0a\u4f20"'.concat(s,'"'),10)}});if(d=Math.min(Math.floor(100*e.loaded/e.total),99),l===d)return;t=(0,W.jsxs)(u.Fragment,{children:[(0,W.jsx)("div",{children:s}),(0,W.jsxs)("div",{children:[(0,q.$j)(e.loaded)," / ",(0,q.$j)(i)]}),(0,W.jsx)(m.Z,{percent:d})]}),g.Z.info({key:o,message:"\u4e0a\u4f20\u4e2d...",duration:null,description:t,placement:"bottomRight",onClose:function(){c.abort(),h.ZP.info('\u60a8\u5df2\u53d6\u6d88\u4e0a\u4f20"'.concat(s,'"'),10)}}),l=d}}),!1),c.onreadystatechange=function(e){if(4===c.readyState)c.status>=200&&c.status<300?f(!0,"\u4e0a\u4f20\u6210\u529f"):c.status>=400&&c.status<500&&f(!1,"\u670d\u52a1\u5668\u5185\u90e8\u9519\u8bef");else{var t=e.currentTarget.responseText.split("\u32a5").filter((function(e){return""!==e}));if(t.length>0){var n=t[t.length-1],r=parseInt(n);d=Math.min(Math.floor(100*r/i),99);var a=(0,W.jsxs)(u.Fragment,{children:[(0,W.jsx)("div",{children:s}),(0,W.jsxs)("div",{children:[(0,q.$j)(r),"/",(0,q.$j)(i)]}),(0,W.jsx)(m.Z,{percent:d})]});g.Z.info({key:o,message:"\u5411\u76ee\u6807\u673a\u5668\u4f20\u8f93\u4e2d...",duration:null,description:a,placement:"bottomRight",onClose:function(){c.abort(),h.ZP.info('\u60a8\u5df2\u53d6\u6d88\u4e0a\u4f20"'.concat(s,'"'),10)}})}}},c.onerror=function(){f(!1,"\u670d\u52a1\u5668\u5185\u90e8\u9519\u8bef")},c.open("POST",a,!0);var p=new FormData;p.append("file",t,s),c.send(p)},e.delete=function(){var t=(0,a.Z)((0,i.Z)().mark((function t(n){var r,s;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=new FormData).append("file",n),t.next=4,H.Z.post("/".concat(e.state.storageType,"/").concat(e.state.storageId,"/rm"),r);case 4:1!==(s=t.sent).code&&h.ZP.error(s.message);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.showEditor=function(){var t=(0,a.Z)((0,i.Z)().mark((function t(n,r){var s;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return h.ZP.loading({key:r,content:"Loading"}),t.next=3,H.Z.get("".concat(M.fw,"/").concat(e.state.storageType,"/").concat(e.state.storageId,"/download?file=").concat(window.encodeURIComponent(r),"&t=").concat((new Date).getTime()));case 3:s=t.sent,e.setState({currentFileKey:r,fileName:n,fileContent:s+"",editorVisible:!0}),h.ZP.destroy(r);case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.hideEditor=function(){e.setState({editorVisible:!1,fileName:"",fileContent:"",currentFileKey:""})},e.edit=(0,a.Z)((0,i.Z)().mark((function t(){var n,r,s;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({confirmLoading:!0}),n="".concat(M.fw,"/").concat(e.state.storageType,"/").concat(e.state.storageId,"/edit"),(r=new FormData).append("file",e.state.currentFileKey),r.append("fileContent",e.state.fileContent),t.next=7,H.Z.post(n,r);case 7:1!==(s=t.sent).code&&h.ZP.error(s.message),e.setState({confirmLoading:!1}),e.hideEditor();case 11:case"end":return t.stop()}}),t)}))),e}return(0,c.Z)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.onRef&&this.props.onRef(this),this.props.storageId&&this.setState({storageId:this.props.storageId,storageType:this.props.storageType,callback:this.props.callback,minHeight:this.props.minHeight,upload:this.props.upload,download:this.props.download,delete:this.props.delete,rename:this.props.rename,edit:this.props.edit},(function(){e.loadFiles(e.state.currentDirectory)}))}},{key:"render",value:function(){var e=this,t=[{title:"\u540d\u79f0",dataIndex:"name",key:"name",render:function(e,t){var n;if(t.isDir)n=(0,W.jsx)(C.Z,{});else if(t.isLink)n=(0,W.jsx)(F.Z,{});else switch(t.name.split(".").pop().toLowerCase()){case"doc":case"docx":n=(0,W.jsx)(D.Z,{});break;case"xls":case"xlsx":n=(0,W.jsx)(I.Z,{});break;case"bmp":case"jpg":case"jpeg":case"png":case"tif":case"gif":case"pcx":case"tga":case"exif":case"svg":case"psd":case"ai":case"webp":n=(0,W.jsx)(R.Z,{});break;case"md":n=(0,W.jsx)(T.Z,{});break;case"pdf":n=(0,W.jsx)(S.Z,{});break;case"txt":n=(0,W.jsx)(N.Z,{});break;case"zip":case"gz":case"tar":case"tgz":n=(0,W.jsx)(L.Z,{});break;default:n=(0,W.jsx)(P.Z,{})}return(0,W.jsxs)("span",{className:"dode",children:[n,"\xa0\xa0",t.name]})},sorter:function(e,t){return".."===e.key||".."===t.key?0:e.name.localeCompare(t.name)},sortDirections:["descend","ascend"]},{title:"\u5927\u5c0f",dataIndex:"size",key:"size",render:function(e,t){return t.isDir||t.isLink?(0,W.jsx)("span",{className:"dode"}):(0,W.jsx)("span",{className:"dode",children:(0,q.$j)(e)})},sorter:function(e,t){return".."===e.key||".."===t.key?0:e.size-t.size}},{title:"\u4fee\u6539\u65e5\u671f",dataIndex:"modTime",key:"modTime",sorter:function(e,t){return".."===e.key||".."===t.key?0:e.modTime.localeCompare(t.modTime)},sortDirections:["descend","ascend"],render:function(e,t){return(0,W.jsx)("span",{className:"dode",children:e})}},{title:"\u5c5e\u6027",dataIndex:"mode",key:"mode",render:function(e,t){return(0,W.jsx)("span",{className:"dode",children:e})}},{title:"\u64cd\u4f5c",dataIndex:"action",key:"action",width:210,render:function(t,n){if(".."!==n.key){var r=!e.state.download,s=!e.state.edit;return(n.isDir||n.isLink)&&(r=!0,s=!0),(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(x.Z,{type:"link",size:"small",disabled:s,onClick:function(){return e.showEditor(n.name,n.key)},children:"\u7f16\u8f91"}),(0,W.jsx)(x.Z,{type:"link",size:"small",disabled:r,onClick:(0,a.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(0,q.LR)("".concat(M.fw,"/").concat(e.state.storageType,"/").concat(e.state.storageId,"/download?file=").concat(window.encodeURIComponent(n.key),"&X-Auth-Token=").concat((0,q.LP)(),"&t=").concat((new Date).getTime()));case 1:case"end":return t.stop()}}),t)}))),children:"\u4e0b\u8f7d"}),(0,W.jsx)(x.Z,{type:"link",size:"small",disabled:!e.state.rename,onClick:function(){e.setState({renameVisible:!0,currentFileKey:n.key})},children:"\u91cd\u547d\u540d"}),(0,W.jsx)(y.Z,{title:"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u6b64\u6587\u4ef6\u5417?",onConfirm:(0,a.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.delete(n.key);case 2:return t.next=4,e.refresh();case 4:case"end":return t.stop()}}),t)}))),okText:"\u662f",cancelText:"\u5426",children:(0,W.jsx)(x.Z,{type:"link",size:"small",disabled:!e.state.delete,danger:!0,children:"\u5220\u9664"})})]})}}}],n=this.state.selectedRowKeys,r={selectedRowKeys:n,onChange:function(t){e.setState({selectedRowKeys:t})},getCheckboxProps:function(e){return{disabled:e.disabled}}},s=n.length>0;s&&(this.state.delete||(s=!1));var o=(0,W.jsxs)("div",{className:"fs-header",children:[(0,W.jsx)("div",{className:"fs-header-left",children:(0,W.jsx)(Z.Z,{value:this.state.currentDirectoryInput,onChange:this.handleCurrentDirectoryInputChange,onPressEnter:this.handleCurrentDirectoryInputPressEnter})}),(0,W.jsx)("div",{className:"fs-header-right",children:(0,W.jsxs)(k.Z,{children:[(0,W.jsx)("div",{className:"fs-header-right-item",children:(0,W.jsx)(j.Z,{title:"\u521b\u5efa\u6587\u4ef6\u5939",children:(0,W.jsx)(x.Z,{type:"primary",size:"small",disabled:!this.state.upload,icon:(0,W.jsx)(z.Z,{}),onClick:function(){e.setState({mkdirVisible:!0})},ghost:!0})})}),(0,W.jsx)("div",{className:"fs-header-right-item",children:(0,W.jsxs)(j.Z,{title:"\u4e0a\u4f20\u6587\u4ef6",children:[(0,W.jsx)(x.Z,{type:"primary",size:"small",icon:(0,W.jsx)(V.Z,{}),disabled:!this.state.upload,onClick:function(){window.document.getElementById("file-upload").click()},ghost:!0}),(0,W.jsx)("input",{type:"file",id:"file-upload",style:{display:"none"},onChange:this.handleUploadFile,multiple:!0})]})}),(0,W.jsx)("div",{className:"fs-header-right-item",children:(0,W.jsxs)(j.Z,{title:"\u4e0a\u4f20\u6587\u4ef6\u5939",children:[(0,W.jsx)(x.Z,{type:"primary",size:"small",icon:(0,W.jsx)(E.Z,{}),disabled:!this.state.upload,onClick:function(){window.document.getElementById("dir-upload").click()},ghost:!0}),(0,W.jsx)("input",{type:"file",id:"dir-upload",style:{display:"none"},onChange:this.handleUploadDir,webkitdirectory:"",multiple:!0})]})}),(0,W.jsx)("div",{className:"fs-header-right-item",children:(0,W.jsx)(j.Z,{title:"\u5237\u65b0",children:(0,W.jsx)(x.Z,{type:"primary",size:"small",icon:(0,W.jsx)(K.Z,{}),onClick:this.refresh,ghost:!0})})}),(0,W.jsx)("div",{className:"fs-header-right-item",children:(0,W.jsx)(j.Z,{title:"\u6279\u91cf\u5220\u9664",children:(0,W.jsx)(x.Z,{type:"primary",size:"small",ghost:!0,danger:!0,disabled:!s,icon:(0,W.jsx)(U.Z,{}),loading:this.state.delBtnLoading,onClick:function(){var t=e.state.selectedRowKeys,n=(0,W.jsxs)("div",{children:["\u60a8\u786e\u5b9a\u8981\u5220\u9664\u9009\u4e2d\u7684",(0,W.jsx)(_,{style:{color:"#1890FF"},strong:!0,children:t.length}),"\u6761\u8bb0\u5f55\u5417\uff1f"]});G({icon:(0,W.jsx)(O.Z,{}),content:n,onOk:function(){var n=(0,a.Z)((0,i.Z)().mark((function n(){var r;return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=0;case 1:if(!(r<t.length)){n.next=9;break}if(".."!==t[r]){n.next=4;break}return n.abrupt("continue",6);case 4:return n.next=6,e.delete(t[r]);case 6:r++,n.next=1;break;case 9:e.refresh();case 10:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),onCancel:function(){}})}})})})]})})]});return(0,W.jsxs)("div",{children:[(0,W.jsx)(v.Z,{title:o,bordered:!0,size:"small",style:{minHeight:this.state.minHeight},children:(0,W.jsx)(b.Z,{columns:t,rowSelection:r,dataSource:this.state.files,size:"small",pagination:!1,loading:this.state.loading,onRow:function(t){return{onDoubleClick:function(n){if(t.isDir||t.isLink)if(".."===t.path){var r=e.state.currentDirectory,s=r.substring(0,r.lastIndexOf("/"));e.loadFiles(s)}else e.loadFiles(t.path)}}}})}),this.state.mkdirVisible?(0,W.jsx)(p.Z,{title:"\u521b\u5efa\u6587\u4ef6\u5939",visible:this.state.mkdirVisible,okButtonProps:{form:"mkdir-form",key:"submit",htmlType:"submit"},onOk:function(){e.mkdirFormRef.current.validateFields().then(function(){var t=(0,a.Z)((0,i.Z)().mark((function t(n){var r,s,a;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.mkdirFormRef.current.resetFields(),r={dir:e.state.currentDirectory+"/"+n.dir},s=B().stringify(r),e.setState({confirmLoading:!0}),t.next=6,H.Z.post("/".concat(e.state.storageType,"/").concat(e.state.storageId,"/mkdir?").concat(s));case 6:1===(a=t.sent).code?(h.ZP.success("\u521b\u5efa\u6210\u529f"),e.loadFiles(e.state.currentDirectory)):h.ZP.error(a.message),e.setState({confirmLoading:!1,mkdirVisible:!1});case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(e){}))},confirmLoading:this.state.confirmLoading,onCancel:function(){e.setState({mkdirVisible:!1})},children:(0,W.jsx)(w.Z,{ref:this.mkdirFormRef,id:"mkdir-form",children:(0,W.jsx)(w.Z.Item,{name:"dir",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6587\u4ef6\u5939\u540d\u79f0"}],children:(0,W.jsx)(Z.Z,{autoComplete:"off",placeholder:"\u8bf7\u8f93\u5165\u6587\u4ef6\u5939\u540d\u79f0"})})})}):void 0,this.state.renameVisible?(0,W.jsx)(p.Z,{title:"\u91cd\u547d\u540d",visible:this.state.renameVisible,okButtonProps:{form:"rename-form",key:"submit",htmlType:"submit"},onOk:function(){e.renameFormRef.current.validateFields().then(function(){var t=(0,a.Z)((0,i.Z)().mark((function t(n){var r,s,a,o;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.renameFormRef.current.resetFields(),t.prev=1,(r=e.state.currentDirectory).endsWith("/")||(r+="/"),(s={oldName:e.state.currentFileKey,newName:r+n.newName}).oldName!==s.newName){t.next=8;break}return h.ZP.success("\u91cd\u547d\u540d\u6210\u529f"),t.abrupt("return");case 8:return a=B().stringify(s),e.setState({confirmLoading:!0}),t.next=12,H.Z.post("/".concat(e.state.storageType,"/").concat(e.state.storageId,"/rename?").concat(a));case 12:1===(o=t.sent).code?(h.ZP.success("\u91cd\u547d\u540d\u6210\u529f"),e.refresh()):h.ZP.error(o.message);case 14:return t.prev=14,e.setState({confirmLoading:!1,renameVisible:!1}),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[1,,14,17]])})));return function(e){return t.apply(this,arguments)}}()).catch((function(e){}))},confirmLoading:this.state.confirmLoading,onCancel:function(){e.setState({renameVisible:!1})},children:(0,W.jsx)(w.Z,{id:"rename-form",ref:this.renameFormRef,initialValues:{newName:(0,q.UO)(this.state.currentFileKey)},children:(0,W.jsx)(w.Z.Item,{name:"newName",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u65b0\u7684\u540d\u79f0"}],children:(0,W.jsx)(Z.Z,{autoComplete:"off",placeholder:"\u65b0\u7684\u540d\u79f0"})})})}):void 0,(0,W.jsx)(p.Z,{title:"\u7f16\u8f91 "+this.state.fileName,className:"modal-no-padding",visible:this.state.editorVisible,destroyOnClose:!0,width:.8*window.innerWidth,centered:!0,okButtonProps:{form:"rename-form",key:"submit",htmlType:"submit"},onOk:this.edit,confirmLoading:this.state.confirmLoading,onCancel:this.hideEditor,children:(0,W.jsx)(u.Suspense,{fallback:(0,W.jsx)(A.Z,{}),children:(0,W.jsx)(X,{language:"javascript",height:.8*window.innerHeight,theme:"vs-dark",value:this.state.fileContent,options:{selectOnLineNumbers:!0},editorDidMount:function(e,t){e.focus()},editorWillUnmount:function(){},onChange:function(t,n){e.setState({fileContent:t})}})})})]})}}]),n}(u.Component),Q=J}}]);